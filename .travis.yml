dist: trusty

env:
  global:
    secure: VXAc/AyNbTnNkdPxcvF0MQwRrAekBZZI7FZgCZCm5PMQndPsMl91s0M12hmketm2/eb2dsKlbcjqB1+QZjVfp7qQasATbeSWIc+smNLlbMHrmSMM7j6EmPNGwcGFBPAJHrOVoJp1cnhE5eDSmcsMgqMt3T8OXSM84zTAmIQ91U25hb4+3AvT7uSH4NFwT+5fYEHGxbp2bBs5cWY+askRQRQ7GbV4We5BjbPgMQ5xS47Y8lh/NpXdDqI2sZkAdGTWtVyvrKp/OVIThUCJt+zXdJlGLNYGHhFbjFM4K/CgQC96H0oo99uPn+469CRRK5e13TTgpRDHN9OTBaLe9p9liylOdSba6BHeFfq+IwmYjSDR3HzHExv/dwuIx47Gca1dzvFohVjFavj0wT6MBcl7aI14xpj+XsFyv92+NVWT/U6Ggfq7AIK/A54dWYCElESBTCM+iNyKjNPMfSExLYB95TlMRt65eVTLwuPDlx78gkpno0O6nG50v44UPCCYEqOFf2lN+3gU7Uq5d4Ll6nUlDm9aSguX/9FpU3Ps0/oJya10M/6BUKArjrPVD5IRduKyV1T1ojbYvs5CF+HT91WjSbZKGIYily9kOjZHWBZPPjtbZxxUZxVxqnt/D08mgGJ/C5C9FC/DzYj6oHY+Psy0YT+sW5kbgORM3jMVabIdZA0=
    DOCKER_USERNAME: liambindle
jobs:
  include:
  - stage: build docker image
    script:
    - echo "$DOCKER_PASSWORD" | docker login -u $DOCKER_USERNAME --password-stdin
    - docker build . --build-arg BASE_IMAGE=ubuntu --build-arg BASE_IMAGE_TAG='16.04'
      -t "liambindle/penelope:$(date '+%g.%m')-ubuntu"
    - docker push "liambindle/penelope:$(date '+%g.%m')-ubuntu"
  - stage: test
  - script: docker run --rm "liambindle/penelope:$(date '+%g.%m')-ubuntu" cat hello.txt