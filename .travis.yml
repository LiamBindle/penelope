language: ruby
services:
- docker
env:
  secure: vQ5QOtHh9CGOrUz+A42OwppSTfaFLLLD9W5OxLS18MdHqqydbALFHMPqNUYNfCq8VGgRW6UJB4w/kl1hqYdOIdB1rPlfIo7n/OE8xz+ek0CgwCVtFff7cSh1J6DJLyOogyFMpDdd2g8n1hEoM/3FbChNzXEasfHZ+h14jkI2eTiEPgwpkyxSgDEUNz+y0GoXhC9ZfkscFBZtSb1uhIKb0ZUxnqptqHkab5fkDhuI8KEmoIrB8Yk6ZYqgmgI5wFKBK0S+AiG9SUDyNghhTuH9EtdLOO6BDETykZuR4gyPuwqc/sC1TmVOrQ1tjpZn112e/HUQT6I7VQZ9pcrecP83idHx87jdLwOxHX/LTTG/+dsENWuR3/b/PmFREZm5Czomz+TlsV8HbsfR0USEu4e2DJuNZqph99QSMBDXFvISWEV0XR+98QeibRok9PoPMsZbapL0h8+NX7nFbmA/xp4CCIc3C8AdCpVk/1sEbqPYIUHGg0iTAe46r4C8gnxcja5ES8Xc6Fh/J3mA072gDdqamWljz208k4xueslgmzIZ7qulkyqBXIcyjB6ckWK5cs+2lfLHM9x2DI137d1o/V5G59HCDnYEPmnyR6urnD/Yi/d39PgJ6BJPL1L4MEzRxn5IJN6dEYEVVwbQR6iLahFYlIpEov//u21JQq2v2V8OkJM=
jobs:
  include:
  - stage: build docker image
    script:
    - echo $DOCKER_USERNAME
    - echo "$DOCKER_PASSWORD" | docker login -u $DOCKER_USERNAME --password-stdin
    - docker build . --build-arg BASE_IMAGE=ubuntu --build-arg BASE_IMAGE_TAG='16.04'
      -t "liambindle/penelope:$(date '+%g.%m')-ubuntu"
    - docker push "liambindle/penelope:$(date '+%g.%m')-ubuntu"
  - stage: test
  - script: docker run --rm "liambindle/penelope:$(date '+%g.%m')-ubuntu" cat hello.txt
